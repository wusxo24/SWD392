import React, { useEffect, useRef } from "react";
import { Chart, registerables } from "chart.js";

Chart.register(...registerables);

const lengthForAgeBabyData = {
  Male: {
    Agemos: [0, 0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5, 8.5, 9.5, 10.5, 11.5, 12.5, 13.5, 14.5, 15.5, 16.5, 17.5, 18.5, 19.5, 20.5, 21.5, 22.5, 23.5, 24.5, 25.5, 26.5, 27.5, 28.5, 29.5, 30.5, 31.5, 32.5, 33.5, 34.5, 35.5
    ],
    "3rd": [44.9250977976054, 47.9781237289086, 52.1985946900997, 55.2632177988627, 57.7304929347406, 59.8256861622673, 61.6638370896265, 63.312242388854, 64.8139541988347, 66.1983256978706, 67.4863482409871, 68.693603040503, 69.8320014339409, 70.9108782371828, 71.9376972069369, 72.9185302489553, 73.8583906008274, 74.7614707523533, 75.63131645364, 76.4709562790104, 77.2830000089799, 78.0697142878296, 78.8330817172154, 79.5748455580292, 80.2965565913491, 80.9995872983678, 81.7446395330885, 82.4736527307001, 83.188122057027, 83.8893068413842, 84.5782638893427, 85.2558869161821, 85.9229395984847, 86.5800851110585, 87.2279127412898, 87.8669617158391, 88.4977409604969
    ],
    "5th": [45.5684090997953, 48.5580920591964, 52.7261065869033, 55.7734505006415, 58.2374433948044, 60.3364690517742, 62.1826080663385, 63.8416613064386, 65.3558384891164, 66.7539798471866, 68.0567455477914, 69.2794921906571, 70.4339743086492, 71.5294120412332, 72.573183808992, 73.5712963119119, 74.5287118963997, 75.4495825856131, 76.3374213958132, 77.1952300188364, 78.0255958397382, 78.8307666113033, 79.612708816061, 80.3731528544819, 81.1136348241789, 81.835518175749, 82.581353443818, 83.3110528286648, 84.0260900564991, 84.7276916167264, 85.4168802715866, 86.0945174468316, 86.7613389249827, 87.4179858742151, 88.0650320338, 88.7030074483648, 89.3324183664647
    ],
    "10th": [46.5542930191283, 49.4578038295636, 53.5536465659792, 56.5777214480317, 59.0383022664733, 61.1440960517707, 63.002959620743, 64.6785365049069, 66.2118122523828, 67.6308774877649, 68.9559062937649, 70.2019246073148, 71.3804554654194, 72.5005495820495, 73.5694592157624, 74.5930947130448, 75.5763433306313, 76.5232975362633, 77.4374223484628, 78.3216802341811, 79.1786261007151, 80.0104805083643, 80.8191869414724, 81.6064574952835, 82.3738080633518, 83.1225894944865, 83.8724497800876, 84.6057624632736, 85.3239891157348, 86.0283299569244, 86.7197799432531, 87.3991747668398, 88.0672298826861, 88.7245734534635, 89.3717742721354, 90.0093653632044, 90.6378640422833
    ],
    "25th": [48.1893738140463, 50.979188894577, 54.9791044093995, 57.9743988163658, 60.4343343865457, 62.5540884936898, 64.4354633830482, 66.1389573500098, 67.7037500029861, 69.1568171782938, 70.5176063572942, 71.8006481524649, 73.0171184560636, 74.1758148300991, 75.2838018914029, 76.3468477709515, 77.3697300415551, 78.3564553342004, 79.3104206167123, 80.2345338332348, 81.1313057809738, 82.0029210701211, 82.8512937059361, 83.6781129605404, 84.484870913977, 85.2729040435318, 86.0370290207216, 86.7832934580158, 87.5131740027243, 88.227875866497, 88.9284011706542, 89.6155978698257, 90.2902017684162, 90.9528710722229, 91.6042146714144, 92.2448151465021, 92.8752486107173
    ],
    "50th": [49.988884079, 52.695975301, 56.628428552, 59.608953427, 62.077000266, 64.216864104, 66.125314898, 67.860179904, 69.459084582, 70.948039123, 72.345861109, 73.666654103, 74.921297174, 76.118375358, 77.264799111, 78.366223087, 79.427340501, 80.452094919, 81.443836034, 82.405436434, 83.339380627, 84.247833944, 85.132696575, 85.995648803, 86.838175097, 87.661609339, 88.452472817, 89.223264339, 89.975492278, 90.710408526, 91.429077621, 92.132423789, 92.821271673, 93.496379457, 94.158465459, 94.808229231, 95.446369813
    ],
    "75th": [51.7712574852631, 54.4405431340853, 58.3505940783497, 61.33788093201, 63.8254260405793, 65.9913066287385, 67.9293475879754, 69.6957947027878, 71.3273536202234, 72.8494700064575, 74.2806018978287, 75.6346184545689, 76.9222432757408, 78.1519584863021, 79.3306066926996, 80.4637989233865, 81.5562016910643, 82.6117438683462, 83.6337690011812, 84.625149679001, 85.5883747924065, 86.5256171998123, 87.4387868475588, 88.3295747071967, 89.1994789390605, 90.0498454931164, 90.8787005572373, 91.6846760256571, 92.4692889214632, 93.2338474937995, 93.9795084259939, 94.7073165354158, 95.4182388451418, 96.1131921689973, 96.7930650441201, 97.4587349014246, 98.1110826134703
    ],
    "90th": [53.3615347489539, 56.0344409944283, 59.9664032927709, 62.9815810038618, 65.4985800404481, 67.6940478686016, 69.6612233008438, 71.4560916317014, 73.1152468262671, 74.6640975696173, 76.1211038001601, 77.5001582544642, 78.8120169668475, 80.0652015503418, 81.2665956603052, 82.4218515364754, 83.5356759291034, 84.6120363751048, 85.6543131460014, 86.6654134890358, 87.6478588148759, 88.6038524153657, 89.5353326608376, 90.4440154924459, 91.3314274071703, 92.1989349712012, 93.0714335250574, 93.9181746482636, 94.7406366331136, 95.5401622624724, 96.3179956489321, 97.0753111049134, 97.8132366010555, 98.5328725420431, 99.2353065322745, 99.9216248249548, 100.592921223266
    ],
    "95th": [54.3072119715771, 56.9990773731045, 60.9646537916633, 64.0078854888541, 66.5488903032389, 68.7653775717319, 70.7512829895234, 72.5630679790426, 74.2376674565529, 75.8007440832438, 77.2709525026483, 78.6623393606722, 79.9857821808662, 81.2499031578935, 82.4616686472545, 83.6268000285099, 84.7500624094899, 85.8354730177395, 86.8864547305889, 87.9059515746162, 88.8965168737897, 89.8603817616653, 90.7995090121291, 91.7156346758992, 92.6103075004739, 93.4849087336022, 94.3877452248001, 95.2630007597693, 96.1121011988834, 96.9363947623564, 97.7371728943947, 98.5156910420506, 99.2731837770055, 100.010876547669, 100.729994719356, 101.431770491437, 102.117447218662
    ],
    "97th": [54.9190044535762, 57.6298432273064, 61.6259148751262, 64.6924090907813, 67.2518959664659, 69.4835396581404, 71.4821822482071, 73.3048834934378, 74.9889928197064, 76.56047112136, 78.0381936701244, 79.4363749829669, 80.7660206662514, 82.0358547387811, 83.2529242781077, 84.423015699161, 85.5509470424253, 86.6407790212955, 87.6959705150485, 88.719495577574, 89.7139327257165, 90.6815343572731, 91.6242812892597, 92.5439238858898, 93.4420266333203, 94.3199804224951, 95.244192989933, 96.1396161063495, 97.0076278952572, 97.8495720091331, 98.6667667910477, 99.460520266677, 100.232139112685, 100.982935160837, 101.714230134913, 102.427359159181, 103.12367158862
    ],
  },
  Female: {
    Agemos: [0, 0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5, 8.5, 9.5, 10.5, 11.5, 12.5, 13.5, 14.5, 15.5, 16.5, 17.5, 18.5, 19.5, 20.5, 21.5, 22.5, 23.5, 24.5, 25.5, 26.5, 27.5, 28.5, 29.5, 30.5, 31.5, 32.5, 33.5, 34.5, 35.5
    ],
    "3rd": [45.0948826086757, 47.4691579210798, 50.9570056178233, 53.6292529172354, 55.8593993638303, 57.8047010891317, 59.5479929662389, 61.1389312239288, 62.6099317860152, 63.9834808678867, 65.275903473378, 66.4994793475434, 67.6637114610333, 68.7761269376622, 69.8428047380368, 70.8687355489754, 71.8580748144161, 72.8143250204203, 73.7404700649121, 74.6390761233502, 75.5123687493777, 76.3622926251531, 77.1905585396518, 77.9986807194647, 78.7880078334209, 79.5597432560035, 80.3399836447861, 81.1133152483163, 81.873342777578, 82.6150644716935, 83.3347329303371, 84.0297181712464, 84.698367159698, 85.339869204126, 85.9541339909327, 86.5416687989135, 87.1034887423911
    ],
    "5th": [45.5756074032262, 47.9632397723035, 51.4799569019402, 54.1790736390626, 56.4333494737886, 58.4003243697912, 60.1632307548084, 61.7720801452771, 63.2595795382136, 64.648448283892, 65.9551975697399, 67.1922564646481, 68.3692485504204, 69.4937991670582, 70.5720679121745, 71.6091122237936, 72.6091432273851, 73.5757102067571, 74.5118366642775, 75.4201225170942, 76.3028222430392, 77.161905465163, 77.9991045975868, 78.8159527193617, 79.6138145644373, 80.3939091825267, 81.1880425327028, 81.9722292694881, 82.7408446834455, 83.489507360581, 84.214958896625, 84.9149438923273, 85.5880888605943, 86.2337857228041, 86.8520842736115, 87.4435872314188, 88.0093655358739
    ],
    "10th": [46.33933651097, 48.7424816756963, 52.2962687115733, 55.0314430575534, 57.3189243814216, 59.3163276815511, 61.1072583629727, 62.7421028311681, 64.2538878034357, 65.6655938984631, 66.9939437112267, 68.2515376575953, 69.4481390536453, 70.591488102113, 71.6878395982049, 72.742330546318, 73.7592390943967, 74.7421714181467, 75.6941996522115, 76.6179655680007, 77.5157598866749, 78.3895838006527, 79.2411973726709, 80.0721580274065, 80.8838514673423, 81.6775173224022, 82.4931841293221, 83.2945896917198, 84.0771733221153, 84.8374122236475, 85.5727280648047, 86.2813902686523, 86.9624207755768, 87.6155015785346, 88.2408864772002, 88.8393197753093, 89.4119588419568
    ],
    "25th": [47.6834546897351, 50.0968551349334, 53.6907813798356, 56.471252168873, 58.803462078233, 60.843862287441, 62.6758970949149, 64.3500534414942, 65.8995209587227, 67.3474459293245, 68.710701883648, 70.0020216928785, 71.2312834164726, 72.4063263933377, 73.5334911968798, 74.6179893515629, 75.6641640294465, 76.6756784417595, 77.6556549949202, 78.6067799947587, 79.5313837937216, 80.4315030102563, 81.3089295059433, 82.1652493713631, 83.0018736150738, 83.8200669785362, 84.6720881213213, 85.5036023508396, 86.3115062063632, 87.0934589510975, 87.8478269972245, 88.5736188166775, 89.2704228999176, 89.9383458987549, 90.5779493515219, 91.1901980158248, 91.7763934746218
    ],
    "50th": [49.286396118, 51.683580573, 55.286128126, 58.093819061, 60.459807634, 62.536696555, 64.406327624, 66.118415533, 67.705744192, 69.191236138, 70.591639237, 71.919616727, 73.185010399, 74.395643786, 75.557854397, 76.676858713, 77.757009856, 78.801984056, 79.814918523, 80.798515316, 81.755120921, 82.686788098, 83.59532461, 84.48233206, 85.349236238, 86.197316902, 87.090263184, 87.957141816, 88.796018399, 89.605511504, 90.38476689, 91.133417221, 91.851543603, 92.539635196, 93.198544285, 93.829453915, 94.433822779
    ],
    "75th": [51.0186957374673, 53.3636233876347, 56.9313607669117, 59.7404469372429, 62.1232951300098, 64.2250712719925, 66.1241785195238, 67.8684993704711, 69.4897495002519, 71.0101890533948, 72.4461366949443, 73.8099684773972, 75.1113294629031, 76.3579061719386, 77.5559396350042, 78.7105780499221, 79.8261262130668, 80.9062264064347, 81.9539923653731, 82.9721103965001, 83.9629169618863, 84.9284590774354, 85.8705419695333, 86.7907671238583, 87.6905622578691, 88.5712095309212, 89.5056243790664, 90.409819647466, 91.2825803646764, 92.1231313812475, 92.9311262420439, 93.7066211970039, 94.4500478190715, 95.1621825659166, 95.8441117544952, 96.4972051892791, 97.1230720411817
    ],
    "90th": [52.7025011515363, 54.9622227613846, 58.4561236882012, 61.2430575079682, 63.6264785034804, 65.7409589481044, 67.6599521762148, 69.4286842451886, 71.077310633283, 72.6271149509581, 74.0937751240296, 75.4892312988745, 76.8228234514385, 78.1020197343567, 79.3329020440415, 80.5205009757141, 81.6690334451603, 82.782075541617, 83.8626908671008, 84.9135276607395, 85.9368934784343, 86.9348134608792, 87.9090763999459, 88.861271598425, 89.7928185194043, 90.7049915253405, 91.6771799476171, 92.6165822490131, 93.5222656486659, 94.3937145442226, 95.2308178950554, 96.0338473177221, 96.8034300986108, 97.5405191361178, 98.2463607452525, 98.9224631324983, 99.5705625418812
    ],
    "95th": [53.7729087781385, 55.9609422583569, 59.3891073401307, 62.1516557869816, 64.5287532586929, 66.6465255567482, 68.5745160669867, 70.3558690749937, 72.0195245465041, 73.5860080640044, 75.0705008752525, 76.4846049480161, 77.8374228517723, 79.1362519137182, 80.3870485957959, 81.5947498562919, 82.7635017421482, 83.8968261114336, 84.9977446900603, 86.0688731589567, 87.1124936280132, 88.1306112849774, 89.1249992524607, 90.0972345401269, 91.0487275197954, 91.980743693395, 92.9757373133401, 93.9369267310196, 94.8633893451586, 95.754640882198, 96.6106146313602, 97.4316380574577, 98.2184020761176, 98.971927774104, 99.693533549472, 100.384796022932, 101.047522729371
    ],
    "97th": [54.4952736403688, 56.6272806300056, 60.0033777126647, 62.7454699723747, 65.115773002808, 67.2339774121665, 69.1666761894822, 70.9554545925054, 72.6283474980047, 74.2053183684792, 75.701181126368, 77.1272879859039, 78.4925662247927, 79.8041869250981, 81.0680136645635, 82.2889138487065, 83.4709806623838, 84.6176952930965, 85.7320478519033, 86.8166292394802, 87.8737020094713, 88.9052558357328, 89.9130514871924, 90.8986561175583, 91.8634726380307, 92.8087592076702, 93.818641483058, 94.7942625783029, 95.7346447679359, 96.6392759813587, 97.5080806700992, 98.3413938922658, 99.1399266631111, 99.9047293169157, 100.637157379525, 101.338825855668, 102.011586398342
    ],
  },
};

const GrowthChart = ({ gender = "Female", data = [], title, yLabel }) => {
  const chartRef = useRef(null);
  const chartInstanceRef = useRef(null);

  useEffect(() => {
    if (chartInstanceRef.current) {
      chartInstanceRef.current.destroy();
    }

    if (chartRef.current) {
      const ctx = chartRef.current.getContext("2d");

      const ageValues = lengthForAgeBabyData[gender].Agemos;

      const percentiles = Object.entries(lengthForAgeBabyData[gender]).reduce(
        (acc, [key, values]) => {
          if (key !== "Agemos") {
            acc[key] = values;
          }
          return acc;
        },
        {}
      );

      const colors = ["#FFAAAA", "#32CD32", "#FF4500", "#FFD700", "#6495ED"];

      chartInstanceRef.current = new Chart(ctx, {
        type: "line",
        data: {
          labels: ageValues,
          datasets: [
            ...Object.entries(percentiles).map(([percentile, values], index) => ({
              label: `${percentile} Percentile`,
              data: values.map((y, i) => ({ x: ageValues[i], y })),
              borderColor: colors[index % colors.length],
              borderWidth: 2,
              fill: false,
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 0,
              pointHitRadius: 15, // Expands the invisible hitbox area
            })),
            {
              label: "User Data",
              data: data,
              borderColor: "black",
              backgroundColor: "orange",
              pointRadius: 6,
              type: "scatter",
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              type: "linear",
              title: { display: true, text: "Age (Months)" },
              ticks: { stepSize: 0.1 },
              min: 0,
              max: 35.5,
            },
            y: {
              title: { display: true, text: yLabel },
              ticks: { stepSize: 0.1 },
              min: 40,
              max: 105,
            },
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function (context) {
                  return `Age: ${context.raw.x.toFixed(1)} months, ${yLabel}: ${context.raw.y} cm`;
                },
              },
              enabled: true, 
              animation: {
              duration: 1000, 
              },
              caretSize: 10,
              displayColors: true,
            },
          },
        },
      });
    }

    return () => {
      if (chartInstanceRef.current) {
        chartInstanceRef.current.destroy();
      }
    };
  }, [gender, data, yLabel]);

  return (
    <div style={{ width: "926px", height: "1098px" }}>
      <canvas ref={chartRef}></canvas>
    </div>
  );
};

export const LengthForAgeChart = ({ gender, data }) => {
  return <GrowthChart gender={gender} data={data} title="Length for Age Chart" yLabel="Length (cm)" />;
};

export default LengthForAgeChart;
