import React, { useEffect, useRef } from "react";
import { Chart, registerables } from "chart.js";

Chart.register(...registerables);

  const headCircumfenceForAgeBabyData = {
            Male: {
              Agemos: [0, 0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5, 8.5, 9.5, 10.5, 11.5, 12.5, 13.5, 14.5, 15.5, 16.5, 17.5, 18.5, 19.5, 20.5, 21.5, 22.5, 23.5, 24.5, 25.5, 26.5, 27.5, 28.5, 29.5, 30.5, 31.5, 32.5, 33.5, 34.5, 35.5, 36
              ],    
              "3th": [31.48762321, 33.25005839, 35.78126227, 37.55879748, 38.89944028, 39.956733, 40.8164238, 41.53109397, 42.13520784, 42.65252672, 43.1000854, 43.49049033, 43.83331672, 44.1359978, 44.40441201, 44.6432831, 44.85646007, 45.0471177, 45.21790307, 45.37104465, 45.50843477, 45.63169289, 45.74221477, 45.84121112, 45.92973857, 46.00872286, 46.07898233, 46.14123974, 46.19613885, 46.24425435, 46.28610129, 46.32214286, 46.35279696, 46.37844176, 46.39942043, 46.41604524, 46.42860105, 46.43343534
              ],
              "5th": [32.14881105, 33.83391575, 36.26427603, 37.97958783, 39.27893049, 40.30765556, 41.14714268, 41.84741554, 42.44134027, 42.95162383, 43.39457866, 43.78229887, 44.12398596, 44.42679395, 44.69638826, 44.93732702, 45.1533284, 45.34746216, 45.52229008, 45.67997038, 45.82233697, 45.95096016, 46.06719402, 46.17221358, 46.26704456, 46.35258644, 46.42963351, 46.49888834, 46.56097639, 46.61645615, 46.66582817, 46.70954267, 46.7480058, 46.78158515, 46.81061427, 46.83539667, 46.85620919, 46.86520671
              ],
              "10th": [33.08389492, 34.67252717, 36.97376845, 38.60724429, 39.85122805, 40.8411358, 41.65290563, 42.33330145, 42.91311128, 43.41364704, 43.85025055, 44.23431798, 44.57453557, 44.87766812, 45.14908116, 45.39309769, 45.61324855, 45.81245227, 45.99314685, 46.1573882, 46.30692463, 46.4432543, 46.56766983, 46.68129357, 46.78510558, 46.87996641, 46.96663488, 47.0457837, 47.11801133, 47.18385241, 47.24378625, 47.29824404, 47.34761489, 47.39225099, 47.43247203, 47.46856894, 47.50080715, 47.51555592
              ],
              "25th": [34.46951803, 35.93986771, 38.07877607, 39.60636994, 40.77712846, 41.71483367, 42.48888872, 43.14204136, 43.70245428, 44.18963565, 44.61764431, 44.99693519, 45.33548679, 45.6395204, 45.91397652, 46.16284044, 46.38937093, 46.5962646, 46.78577645, 46.95980996, 47.1199854, 47.2676925, 47.4041314, 47.53034509, 47.64724492, 47.75563267, 47.85621436, 47.9496179, 48.03640172, 48.11706526, 48.19205668, 48.26177952, 48.32659828, 48.38684322, 48.44281439, 48.49478513, 48.54300509, 48.56578071
              ],
              "50th": [35.81366835, 37.19361054, 39.20742929, 40.65233195, 41.76516959, 42.66116148, 43.40488731, 44.03609923, 44.58096912, 45.05761215, 45.4790756, 45.85505706, 46.19295427, 46.49853438, 46.77637684, 47.03017599, 47.2629533, 47.47720989, 47.67503833, 47.85820606, 48.02821867, 48.18636864, 48.3337732, 48.47140432, 48.60011223, 48.72064621, 48.83366629, 48.93976089, 49.03945383, 49.13321432, 49.22146409, 49.30458348, 49.38291658, 49.45677569, 49.526445, 49.59218385, 49.65422952, 49.68393611
              ],
              "75th": [37.00426196, 38.3212548, 40.2498675, 41.63967944, 42.71454952, 43.58358267, 44.30801, 44.92554888, 45.46103549, 45.93165855, 46.34979269, 46.72463077, 47.06318161, 47.37090639, 47.65213989, 47.9103782, 48.14848042, 48.36881356, 48.57335854, 48.76378933, 48.94153284, 49.10781495, 49.26369641, 49.41010098, 49.54783776, 49.67762038, 49.80007885, 49.91577508, 50.02521023, 50.12883385, 50.22705052, 50.32022568, 50.4086904, 50.49274559, 50.57266545, 50.64870057, 50.72108047, 50.75596627
              ],
              "90th": [37.97379421, 39.24988502, 41.12605049, 42.48435504, 43.5390162, 44.39471535, 45.11034335, 45.72225458, 46.25442887, 46.72349076, 47.14142337, 47.5171388, 47.85743833, 48.1676259, 48.4519147, 48.71370522, 48.95578033, 49.18044547, 49.38963138, 49.58497069, 49.767856, 49.93948448, 50.10089268, 50.25298383, 50.39654965, 50.53228805, 50.6608169, 50.78268619, 50.89838727, 51.00836092, 51.11300399, 51.212675, 51.30769888, 51.39837096, 51.48496048, 51.56771347, 51.64685536, 51.68513749
              ],
              "95th": [38.51574, 39.77261565, 41.62581415, 42.97189144, 44.01984454, 44.87197284, 45.58592624, 46.19735808, 46.7298272, 47.19970004, 47.61879558, 47.99592075, 48.33780885, 48.64971976, 48.93583823, 49.19954641, 49.44361553, 49.67034368, 49.88165697, 50.07918514, 50.26431891, 50.43825419, 50.60202648, 50.75653813, 50.90258011, 51.04084871, 51.17196156, 51.29646691, 51.41485491, 51.52756491, 51.63499226, 51.73749389, 51.83539311, 51.92898358, 52.01853284, 52.10428523, 52.18646448, 52.22627901
              ],
              "97th": [38.85417217, 40.10028445, 41.94137873, 43.28180775, 44.3273323, 45.17876946, 45.89299742, 46.50523827, 47.03879825, 47.50989695, 47.93026746, 48.30866909, 48.65181107, 48.96494367, 49.25225076, 49.51711865, 49.76232529, 49.99017661, 50.20260675, 50.40125302, 50.58751304, 50.76258871, 50.92752068, 51.0832155, 51.23046767, 51.36997568, 51.50235977, 51.62816923, 51.74789519, 51.8619775, 51.97081164, 52.0747544, 52.17412868, 52.26922758, 52.36031789, 52.44764311, 52.53142603, 52.57205364
              ],
            },
            Female: {
              Agemos: [0, 0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5, 8.5, 9.5, 10.5, 11.5, 12.5, 13.5, 14.5, 15.5, 16.5, 17.5, 18.5, 19.5, 20.5, 21.5, 22.5, 23.5, 24.5, 25.5, 26.5, 27.5, 28.5, 29.5, 30.5, 31.5, 32.5, 33.5, 34.5, 35.5, 36
              ],    
              "3th": [31.93019666, 33.38070525, 35.48627093, 36.98550023, 38.13114313, 39.04619196, 39.79959574, 40.43379494, 40.97671526, 41.44767738, 41.86058302, 42.22575305, 42.55105219, 42.84260355, 43.10526272, 43.34294145, 43.55883459, 43.75558315, 43.93539362, 44.10012707, 44.25136665, 44.39046947, 44.51860703, 44.63679702, 44.74592866, 44.8467831, 44.94004992, 45.02634065, 45.10619989, 45.18011452, 45.24852146, 45.31181411, 45.37034782, 45.42444455, 45.47439662, 45.52047097, 45.56291074, 45.58283802
              ],
              "5th": [32.25089861, 33.68743507, 35.77560367, 37.26521982, 38.40560987, 39.31813786, 40.07085921, 40.70567458, 41.25016088, 41.72340175, 42.1391311, 42.50754798, 42.83642568, 43.13181766, 43.39852553, 43.64041855, 43.86065785, 44.06185727, 44.24620133, 44.4155332, 44.57142131, 44.71521065, 44.84806267, 44.9709867, 45.08486501, 45.19047292, 45.28849516, 45.37953915, 45.46414607, 45.54279995, 45.61593528, 45.68394345, 45.74717813, 45.80595987, 45.86057993, 45.91130407, 45.95837475, 45.98061022
              ],
              "10th": [32.75948527, 34.17345861, 36.23325692, 37.70685493, 38.83813686, 39.74588078, 40.49672423, 41.13171253, 41.67787092, 42.15390873, 42.57329563, 42.94603917, 43.27976931, 43.58043062, 43.85274045, 44.10050201, 44.32682391, 44.53427792, 44.72501451, 44.90084908, 45.06332728, 45.21377531, 45.35333901, 45.48301476, 45.60367396, 45.71608285, 45.82091847, 45.91878183, 46.01020865, 46.09567835, 46.17562155, 46.25042633, 46.32044357, 46.38599146, 46.44735943, 46.50481123, 46.55858812, 46.58416826
              ],
              "25th": [33.65186554, 35.02508397, 37.03281566, 38.47603153, 39.58904997, 40.4861083, 41.23135738, 41.86434514, 42.41113299, 42.88977797, 43.31329057, 43.69134604, 44.03132658, 44.33898883, 44.61890505, 44.87476468, 45.10958609, 45.32586864, 45.52570414, 45.71086007, 45.88284266, 46.04294544, 46.19228703, 46.33184096, 46.46245944, 46.58489242, 46.69980317, 46.80778091, 46.90935129, 47.00498513, 47.0951056, 47.18009439, 47.26029687, 47.33602646, 47.40756856, 47.47518307, 47.53910827, 47.56975632
              ],
              "50th": [34.7115617, 36.03453876, 37.97671987, 39.3801263, 40.46773733, 41.34841008, 42.0833507, 42.71033603, 43.25428882, 43.73249646, 44.15742837, 44.53836794, 44.88240562, 45.19507651, 45.48078147, 45.74307527, 45.98486901, 46.20857558, 46.41621635, 46.60950084, 46.78988722, 46.95862881, 47.11681039, 47.26537682, 47.40515585, 47.53687649, 47.66118396, 47.77865186, 47.8897923, 47.99506422, 48.09488048, 48.18961365, 48.2796011, 48.36514917, 48.44653703, 48.52401894, 48.59782828, 48.63342328
              ],
              "75th": [35.85124044, 37.11806755, 38.9853304, 40.34145495, 41.39732095, 42.2560375, 42.97566066, 43.59207071, 44.1289691, 44.60281599, 45.025498, 45.40587424, 45.75071845, 46.06532374, 46.3539026, 46.61986076, 46.86598965, 47.09460485, 47.30764771, 47.50676129, 47.69334806, 47.86861428, 48.03360465, 48.18922971, 48.3362876, 48.47548169, 48.60743482, 48.73270105, 48.85177527, 48.96510128, 49.07307846, 49.17606748, 49.27439505, 49.36835799, 49.45822692, 49.54424855, 49.62664932, 49.66655746
              ],
              "90th": [36.9534983, 38.16405088, 39.95458524, 41.2606303, 42.28152907, 43.11489105, 43.81574641, 44.41814599, 44.94460711, 45.41078317, 45.82798881, 46.2046631, 46.54726413, 46.86084173, 47.14941728, 47.41624393, 47.66398946, 47.89486804, 48.11073684, 48.31316842, 48.50350565, 48.68290399, 48.85236462, 49.01276045, 49.16485698, 49.30932908, 49.44677462, 49.57772565, 49.70265762, 49.82199704, 49.93612795, 50.04539729, 50.15011948, 50.25058031, 50.34704031, 50.43973755, 50.52889019, 50.57220052
              ],
              "95th": [37.65137722, 38.82535049, 40.56517149, 41.83732218, 42.83395649, 43.64924082, 44.33630066, 44.92802856, 45.44618705, 45.90591158, 46.31814685, 46.69105794, 47.0308956, 47.34254856, 47.62991078, 47.89613288, 48.14379909, 48.37505457, 48.59169895, 48.79525631, 48.98702837, 49.16813538, 49.33954821, 49.50211352, 49.65657394, 49.80358436, 49.94372506, 50.07751255, 50.20540857, 50.32782741, 50.44514221, 50.55769018, 50.66577699, 50.7696806, 50.86965434, 50.96593013, 51.05872021, 51.1038697
              ],
              "97th": [38.12110271, 39.27005698, 40.97482424, 42.22321458, 43.20260356, 44.00485959, 44.68183088, 45.26562921, 45.77750554, 46.23224218, 46.64053024, 47.01034581, 47.34779597, 47.65765724, 47.9437344, 48.20910612, 48.45629769, 48.68740549, 48.90418837, 49.10813597, 49.30052069, 49.48243771, 49.65483625, 49.81854421, 49.97428788, 50.12270782, 50.26437172, 50.39978499, 50.52939951, 50.65362082, 50.77281425, 50.88731003, 50.99740757, 51.10337919, 51.20547307, 51.30391674, 51.39891816, 51.44518843
              ],
            }
            };

const GrowthChart = ({ gender = "Female", data = [], title, yLabel }) => {
  const chartRef = useRef(null);
  const chartInstanceRef = useRef(null);

  useEffect(() => {
    if (chartInstanceRef.current) {
      chartInstanceRef.current.destroy();
    }

    if (chartRef.current) {
      const ctx = chartRef.current.getContext("2d");

      const ageValues = headCircumfenceForAgeBabyData[gender].Agemos.map(
        (age) => age
      );

      const percentiles = Object.entries(headCircumfenceForAgeBabyData[gender])
        .filter(([key]) => key !== "Agemos")
        .reduce((acc, [percentile, values]) => {
          acc[percentile] = values;
          return acc;
        }, {});

      const colors = [
        "#FFAAAA",
        "#32CD32",
        "#FF4500",
        "#FFD700",
        "#6495ED",
        "#9400D3",
        "#00CED1",
        "#DC143C",
        "#FFA500",
      ];

      chartInstanceRef.current = new Chart(ctx, {
        type: "line",
        data: {
          labels: ageValues,
          datasets: [
            ...Object.entries(percentiles).map(([percentile, values], index) => ({
              label: `${percentile} Percentile`,
              data: values.map((y, i) => ({ x: ageValues[i], y })),
              borderColor: colors[index % colors.length],
              borderWidth: 2,
              fill: false,
              tension: 0.4,
              pointRadius: 0,
              pointHoverRadius: 0,
              pointHitRadius: 15, // Expands the invisible hitbox area
            })),
            {
              label: "User Data",
              data: data,
              borderColor: "black",
              backgroundColor: "orange",
              pointRadius: 6,
              type: "scatter",
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              type: "linear",
              title: { display: true, text: "Age (Months)" },
              ticks: { stepSize: 0.1 },
              min: 0,
              max: 36,
            },
            y: {
              title: { display: true, text: yLabel },
              ticks: { stepSize: 0.1 },
              min: 30,
              max: 54,
            },
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function (context) {
                  return `Age: ${context.raw.x.toFixed(1)} months, ${yLabel}: ${context.raw.y} cm`;
                },
              },
              enabled: true, 
              animation: {
              duration: 1000, 
              },
              caretSize: 10,
              displayColors: true, 
            },
          },
        },
      });
    }

    return () => {
      if (chartInstanceRef.current) {
        chartInstanceRef.current.destroy();
      }
    };
  }, [gender, data, yLabel]);

  return (

    <div style={{ width: "926px", height: "1098px" }}>
      <canvas ref={chartRef}></canvas>
    </div>
  );
};

export const HeadCircumferenceChart = ({ gender, data }) => {
  return (
    <GrowthChart
      gender={gender}
      data={data}
      title="Head Circumference Growth Chart"
      yLabel="Head Circumference (cm)"
    />
  );
};

export default HeadCircumferenceChart;
